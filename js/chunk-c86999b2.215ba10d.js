(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c86999b2"],{"068a":function(t,e,o){"use strict";o("4cb7")},"3a78":function(t,e,o){t.exports=o.p+"img/bus.74cc71fb.png"},"4cb7":function(t,e,o){},"6cec":function(t,e,o){"use strict";o.r(e);var a=o("7a23"),n={class:"gradualBg"},c={class:"col-md-8 col-12 row"},r={class:"mapCube px-0"},i={style:{"font-size":"14px"},class:"badgeBusStopInfo"},s={class:"badgeBusStopInfo"},l={class:"col-md-4 col-12 row px-3 nearbuscardHeight"},u={class:"card-body row"},d={class:"col-6"},p={class:"col-6"},h=Object(a["g"])("div",{class:"col-6 mt-1"},null,-1),b={class:"col-6 mt-1"};function f(t,e,o,f,g,m){var O=Object(a["A"])("NavHeader"),j=Object(a["A"])("l-tile-layer"),v=Object(a["A"])("l-icon"),w=Object(a["A"])("l-popup"),S=Object(a["A"])("l-marker"),C=Object(a["A"])("l-map");return Object(a["u"])(),Object(a["f"])("div",n,[Object(a["h"])(O),Object(a["g"])("div",{class:"row justify-content-center",style:Object(a["o"])(g.homeBg)},[Object(a["g"])("div",c,[Object(a["g"])("div",r,[Object(a["h"])(C,{ref:"myMap",zoom:g.zoom,center:g.localCenter,options:g.mapOptions},{default:Object(a["H"])((function(){return[Object(a["h"])(j,{url:g.urlLocal,attribution:g.localAttribution},null,8,["url","attribution"]),(Object(a["u"])(!0),Object(a["f"])(a["a"],null,Object(a["z"])(g.nearStopData,(function(t,e){return Object(a["u"])(),Object(a["d"])(S,{"lat-lng":[t.lat,t.lon],key:e},{default:Object(a["H"])((function(){return[Object(a["h"])(v,{"icon-url":g.icon.black,"shadow-url":g.icon.shadowUrl,"icon-size":g.icon.iconSize,"icon-anchor":g.icon.iconAnchor,"popup-anchor":g.icon.popupAnchor,"shadow-size":g.icon.shadowSize},null,8,["icon-url","shadow-url","icon-size","icon-anchor","popup-anchor","shadow-size"]),Object(a["h"])(w,null,{default:Object(a["H"])((function(){return[Object(a["g"])("div",i,Object(a["C"])(t.stopname),1),Object(a["g"])("span",s,"行駛路線:"+Object(a["C"])(t.RouteNameNo),1)]})),_:2},1024)]})),_:2},1032,["lat-lng"])})),128))]})),_:1},8,["zoom","center","options"])])]),Object(a["g"])("div",l,[(Object(a["u"])(!0),Object(a["f"])(a["a"],null,Object(a["z"])(g.nearStopData,(function(t,e){return Object(a["u"])(),Object(a["f"])("div",{class:"card mt-2 nearbuscard",key:e},[Object(a["g"])("div",u,[Object(a["g"])("div",d,"站名:"+Object(a["C"])(t.stopname),1),Object(a["g"])("div",p,"路線:"+Object(a["C"])(t.RouteNameNo),1),h,Object(a["g"])("div",b,Object(a["C"])(t.EstimateTime),1)])])})),128))])],4)])}var g=o("1da1"),m=(o("96cf"),o("99af"),o("d3b7"),o("cce9")),O=o("6c2d"),j={name:"rideplan",components:{NavHeader:m["a"]},data:function(){return{homeBg:{width:"100vw",height:"100vh",zIndex:"2",backgroundSize:"cover",backgroundImage:"url(".concat(o("43af"),")")},busImgHalf:{backgroundImage:"url(".concat(o("3a78"),")"),backgroundRepeat:"no-repeat",width:"100%",height:"100%"},zoom:"16",localCenter:[25.0375417,121.5644327],mapOptions:{zoomControl:!1},localAttribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',urlLocal:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",icon:{iconSize:[25,34.5],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",black:"".concat(o("5591"))},searchDistance:"500",nearStopData:[]}},methods:{getAuthorizationHeader:function(){var t="71661ab7d83947fd9e8553690d6cc7bc",e="5Wd31rSWRfudLXs4hoL7jdfTs5U",o=(new Date).toGMTString(),a=new O["a"]("SHA-1","TEXT");a.setHMACKey(e,"TEXT"),a.update("x-date: "+o);var n=a.getHMAC("B64"),c='hmac username="'.concat(t,'", algorithm="hmac-sha1", headers="x-date", signature="').concat(n,'"');return{Authorization:c,"X-Date":o}},nearBusStopFn:function(){var t=this;this.axios({method:"get",headers:this.getAuthorizationHeader(),url:"https://ptx.transportdata.tw/MOTC/v2/Bus/Stop/NearBy?$spatialFilter=nearby(".concat(this.localCenter[0],"%2C%20").concat(this.localCenter[1],"%2C%20").concat(this.searchDistance,")")}).then((function(e){console.log(e.data);for(var o=e.data,a=0;o.length>a;a++)t.nearStopData.push({lat:o[a].StopPosition.PositionLat,lon:o[a].StopPosition.PositionLon,stopname:o[a].StopName.Zh_tw,stopUID:o[a].StopUID});t.nearBusArrivalFn()}))},nearBusArrivalFn:function(){var t=this;this.axios({method:"get",header:this.getAuthorizationHeader(),url:"https://ptx.transportdata.tw/MOTC/v2/Bus/EstimatedTimeOfArrival/NearBy?%24top=30&%24spatialFilter=nearby(".concat(this.localCenter[0],"%2C%20").concat(this.localCenter[1],"%2C%20").concat(this.searchDistance,")")}).then((function(e){console.log(e.data);for(var o=e.data,a=0;o.length>a;a++)for(var n=0;t.nearStopData.length>n;n++)if(o[a].StopUID===t.nearStopData[n].stopUID){var c=void 0;o[a].EstimateTime?(c=Math.ceil(o[a].EstimateTime/60),t.nearStopData[n]["Direction"]=o[a].Direction):c="未發車",1===c&&(c="Coming soon"),t.nearStopData[n]["RouteNameNo"]=o[a].RouteName.Zh_tw,t.nearStopData[n]["EstimateTime"]=c+"分"}console.log(t.nearStopData)}))},stopInfoFn:function(t){console.log(t)}},mounted:function(){var t=this;return new Promise((function(e){e(),t.$nextTick(Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,navigator.geolocation.getCurrentPosition((function(e){var o=e.coords;t.localCenter=[o.latitude,o.longitude],console.log(t.localCenter)}));case 2:case"end":return e.stop()}}),e)}))))})).then((function(){setTimeout((function(){t.nearBusStopFn()}),100),setInterval(t.nearBusStopFn,6e4)}))}},v=(o("068a"),o("6b0d")),w=o.n(v);const S=w()(j,[["render",f]]);e["default"]=S},"99af":function(t,e,o){"use strict";var a=o("23e7"),n=o("da84"),c=o("d039"),r=o("e8b5"),i=o("861d"),s=o("7b0b"),l=o("07fa"),u=o("8418"),d=o("65f0"),p=o("1dde"),h=o("b622"),b=o("2d00"),f=h("isConcatSpreadable"),g=9007199254740991,m="Maximum allowed index exceeded",O=n.TypeError,j=b>=51||!c((function(){var t=[];return t[f]=!1,t.concat()[0]!==t})),v=p("concat"),w=function(t){if(!i(t))return!1;var e=t[f];return void 0!==e?!!e:r(t)},S=!j||!v;a({target:"Array",proto:!0,forced:S},{concat:function(t){var e,o,a,n,c,r=s(this),i=d(r,0),p=0;for(e=-1,a=arguments.length;e<a;e++)if(c=-1===e?r:arguments[e],w(c)){if(n=l(c),p+n>g)throw O(m);for(o=0;o<n;o++,p++)o in c&&u(i,p,c[o])}else{if(p>=g)throw O(m);u(i,p++,c)}return i.length=p,i}})}}]);
//# sourceMappingURL=chunk-c86999b2.215ba10d.js.map